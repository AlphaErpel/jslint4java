<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id$ -->
<project name="jslint-antunit"
         default="allTests"
         xmlns:au="antlib:org.apache.ant.antunit"
         xmlns:jsl="antlib:com.googlecode.jslint4java">
    <description>
Tests for the JSLint ant task.
    </description>

    <taskdef uri="antlib:org.apache.ant.antunit"
             resource="org/apache/ant/antunit/antlib.xml"
             classpath="${test.classpath}" />
    <taskdef uri="antlib:com.googlecode.jslint4java"
             resource="com/googlecode/jslint4java/antlib.xml"
             classpath="${test.classpath}" />

    <!-- Have to convert from boolean for use in target/@unless. -->
    <condition property="skipping">
        <istrue value="${test.skipped}" />
    </condition>

    <target name="allTests" unless="skipping">
        <au:antunit failonerror="true">
            <file file="${ant.file}" />
            <!-- Add logLevel="info" attribute for debugging. -->
            <au:plainlistener />
        </au:antunit>
    </target>

    <target name="testNoResources">
        <au:expectfailure expectedmessage="no resources specified">
            <jsl:jslint />
        </au:expectfailure>
    </target>

    <target name="testFailsOnError">
        <au:expectfailure expectedmessage="JSLint: 1 error in 1 file">
            <jsl:jslint>
                <fileset file="good.js" />
                <fileset file="bad.js" />
            </jsl:jslint>
        </au:expectfailure>
    </target>

    <target name="testSuccess">
        <jsl:jslint>
            <fileset file="good.js" />
        </jsl:jslint>
    </target>

    <!-- This should turn off the undef option. -->
    <target name="testOptionParams">
        <jsl:jslint options="undef=false">
            <fileset file="undef.js" />
        </jsl:jslint>
    </target>

    <!-- http://code.google.com/p/jslint4java/issues/detail?id=6 -->
    <target name="testIssue6">
        <au:expectfailure expectedmessage="JSLint: 2 errors in 1 file">
            <jsl:jslint options="browser,undef,passfail">
                <formatter type="plain" />
                <fileset file="issue6.js" />
            </jsl:jslint>
        </au:expectfailure>
        <!-- This is not the exact same message reported, but was how I was
             able to trigger the same condition. -->
        <au:assertLogContains text="Missing semicolon." />
    </target>

    <target name="testArbitraryResource">
        <au:expectfailure expectedmessage="JSLint: 1 error in 1 file">
            <jsl:jslint>
                <formatter type="plain" />
                <string value="eval(42);" />
            </jsl:jslint>
        </au:expectfailure>
    </target>

    <!-- http://code.google.com/p/jslint4java/issues/detail?id=21 -->
    <target name="testNamesInOutputHavePath">
        <au:expectfailure expectedmessage="JSLint: 1 error in 1 file">
            <jsl:jslint>
                <formatter type="plain" />
                <fileset dir="subdir" includes="*.js" />
            </jsl:jslint>
        </au:expectfailure>
        <au:assertLogContains text="subdir/issue21.js:1:24:Missing semicolon." />
    </target>
</project>
